{"version":3,"file":"fireworks.mjs","sources":["../ts/util.ts","../ts/particle.ts","../ts/things.ts","../ts/fireworks.ts"],"sourcesContent":["/**\n * Returns a random number between min and max\n * @param {number} min minimum number\n * @param {number} max maximum number\n */\nexport function random(min: number, max: number): number {\n  return Math.random() * (max - min) + min\n}\n\n/**\n * Tau is Pi multiplied by two.\n */\nexport const TAU = Math.PI * 2\n","import { random, TAU } from './util'\n\nexport type Point = {\n  x: number\n  y: number\n}\n\ntype ParticleOptions = {\n  position: Point\n  isRocket?: boolean\n  hue?: number\n  brightness?: number\n}\n\nexport default class Particle {\n  public isRocket: boolean\n  private positions: Point[]\n  private position: Point\n  private velocity: Point\n  private resistance: number\n  private gravity: number\n  private fade: number\n  private shrink: number\n  private size: number\n  private alpha: number\n  private hue: number\n  private brightness: number\n\n  constructor({\n    isRocket = false,\n    hue = random(1, 360),\n    brightness = random(50, 60),\n    position,\n  }: ParticleOptions) {\n    this.isRocket = isRocket\n    this.position = position\n    this.positions = [this.position, this.position, this.position]\n\n    if (this.isRocket) {\n      this.velocity = {\n        x: random(-3, 3),\n        y: random(-7, -3),\n      }\n      this.shrink = 0.999\n      this.resistance = 1\n    } else {\n      const angle = random(0, TAU)\n      const speed = Math.cos(random(0, TAU)) * 15\n      this.velocity = {\n        x: Math.cos(angle) * speed,\n        y: Math.sin(angle) * speed,\n      }\n      this.shrink = random(0, 0.05) + 0.93\n      this.resistance = 0.92\n    }\n\n    this.gravity = 0.01\n    this.size = 3\n    this.alpha = 1\n    this.fade = 0\n    this.hue = hue\n    this.brightness = brightness\n  }\n\n  /**\n   * Clones a particle, same hue/brightness/position\n   * @returns {Particle} new particle\n   */\n  clone(): Particle {\n    return new Particle({\n      position: {\n        x: this.position.x,\n        y: this.position.y,\n      },\n      hue: this.hue,\n      brightness: this.brightness,\n    })\n  }\n\n  /**\n   * Checks if a particle should be removed.\n   * @param particle particle to check\n   * @returns {boolean} whether or not the particle should be removed.\n   */\n  shouldRemove(cw: number, ch: number): boolean {\n    if (this.alpha <= 0.1 || this.size <= 1) {\n      return true\n    }\n\n    if (this.position.x > cw || this.position.x < 0) {\n      return true\n    }\n\n    if (this.position.y > ch || this.position.y < 0) {\n      return true\n    }\n\n    return false\n  }\n\n  /**\n   * Determines if a rocket should explode - based on explosionHeight & explosionChance\n   * @param {Particle} particle rocket to check\n   * @returns {boolean} whether or not the rocket shoudl explode\n   */\n  shouldExplode(maxHeight: number, minHeight: number, chance: number): boolean {\n    if (!this.isRocket) {\n      return false\n    }\n\n    // make sure things explode once they hit explosionMaxHeight (90% default) of height\n    if (this.position.y <= maxHeight) {\n      return true\n    }\n\n    // make sure particle has reached explosionMinHeight (20% default) before explosion chance.\n    if (this.position.y >= minHeight) {\n      return false\n    }\n\n    return random(0, 1) <= chance\n  }\n\n  /**\n   * Update the position of the particle.\n   * For rockets, has a potential to explode.\n   */\n  update(): void {\n    this.positions.pop()\n    this.positions.unshift({ x: this.position.x, y: this.position.y })\n    this.velocity.x *= this.resistance\n    this.velocity.y *= this.resistance\n    this.velocity.y += this.gravity\n    this.position.x += this.velocity.x\n    this.position.y += this.velocity.y\n    this.size *= this.shrink\n    this.alpha -= this.fade\n  }\n\n  /**\n   * Renders a particle. Returns whether or not it should exist.\n   * @param {CanvasRenderingContext2D} ctx canvas context\n   */\n  draw(ctx: CanvasRenderingContext2D): void {\n    const lastPosition = this.positions[this.positions.length - 1]\n    ctx.beginPath()\n    ctx.moveTo(lastPosition.x, lastPosition.y)\n    ctx.lineTo(this.position.x, this.position.y)\n    ctx.lineWidth = this.size\n    ctx.lineCap = 'round'\n    ctx.strokeStyle = `hsla(${this.hue}, 100%, ${this.brightness}%, ${this.alpha})`\n    ctx.stroke()\n  }\n}\n","import Particle, { Point } from './particle'\nimport { random } from './util'\n\ntype ThingOptions = {\n  cw: number\n  ch: number\n  maxRockets: number\n  numParticles: number\n  rocketInitialPoint: number\n  cannons: Point[]\n}\n\nexport default class Things {\n  private _set: Set<Particle>\n  private maxRockets: number\n  private numParticles: number\n  public cw: number\n  public ch: number\n  public rockets: number\n  public rocketInitialPoint: number\n  private cannons: Point[]\n\n  constructor({\n    maxRockets,\n    numParticles,\n    cw,\n    ch,\n    rocketInitialPoint,\n    cannons,\n  }: ThingOptions) {\n    this._set = new Set()\n    this.rockets = 0\n    this.maxRockets = maxRockets\n    this.numParticles = numParticles\n    this.cw = cw\n    this.ch = ch\n    this.rocketInitialPoint = rocketInitialPoint\n\n    this.cannons = cannons\n\n    if (this.rocketInitialPoint) {\n      this.cannons.push({ x: this.rocketInitialPoint, y: this.ch })\n    }\n  }\n\n  size(): number {\n    return this._set.size\n  }\n\n  entries(): Set<Particle> {\n    return this._set\n  }\n\n  clear(): void {\n    this._set.clear()\n    this.rockets = 0\n  }\n\n  delete(thing: Particle): void {\n    this._set.delete(thing)\n    if (thing.isRocket) this.rockets--\n  }\n\n  add(thing: Particle): void {\n    this._set.add(thing)\n  }\n\n  /**\n   * Turn a particle into many particles exploding in different directions.\n   * Rocket is deleted afterwards,\n   * @param {Particle} particle the rocket to start from.\n   */\n  explode(particle: Particle): void {\n    for (let i = 0; i < this.numParticles; i += 1) {\n      this.add(particle.clone())\n    }\n    this.delete(particle)\n  }\n\n  /**\n   * Spawns a single rocket\n   */\n  spawnRocket(): void {\n    this.rockets++\n    const cannonIndex = Math.floor(random(0, this.cannons.length))\n    const cannon = this.cannons[cannonIndex] || ({} as Point)\n    this.add(\n      new Particle({\n        isRocket: true,\n        position: {\n          ...cannon,\n          ...(cannon.x == null && { x: random(0, this.cw) }),\n          ...(cannon.y == null && { y: this.ch }),\n        },\n      })\n    )\n  }\n\n  /**\n   * if we have less than required number of rockets, spawn one.\n   * this mutates the Set, adding more rockets.\n   */\n  spawnRockets(): void {\n    if (this.rockets < this.maxRockets) {\n      this.spawnRocket()\n    }\n  }\n}\n","import { Point } from './particle'\nimport Things from './things'\n\ntype Options = {\n  maxRockets?: number\n  numParticles?: number\n  explosionMinHeight?: number\n  explosionMaxHeight?: number\n  explosionChance?: number\n  rocketSpawnInterval?: number\n  width?: number\n  height?: number\n  rocketInitialPoint?: number\n  cannons?: Point[]\n}\n\nexport default class Fireworks {\n  private container: HTMLElement\n  private maxRockets: number\n  private rocketSpawnInterval: number\n  private cw: number\n  private ch: number\n  private minH: number\n  private maxH: number\n  private chance: number\n  private things: Things\n  private interval: number\n  private rafInterval: number\n\n  private finishCallbacks: Array<() => void> = []\n\n  private canvas: HTMLCanvasElement\n  private ctx: CanvasRenderingContext2D\n  private pixelRatio: number\n\n  constructor(\n    container: HTMLElement,\n    {\n      rocketSpawnInterval = 150,\n      maxRockets = 3,\n      numParticles = 100,\n      explosionMinHeight = 0.2,\n      explosionMaxHeight = 0.9,\n      explosionChance = 0.08,\n      width = container.clientWidth,\n      height = container.clientHeight,\n      rocketInitialPoint = null,\n      cannons = [],\n    }: Options = {}\n  ) {\n    this.container = container\n    this.rocketSpawnInterval = rocketSpawnInterval\n    this.maxRockets = maxRockets\n    this.cw = width\n    this.ch = height\n    this.maxH = this.ch * (1 - explosionMaxHeight)\n    this.minH = this.ch * (1 - explosionMinHeight)\n    this.chance = explosionChance\n    this.pixelRatio = window.devicePixelRatio || 1\n    this.canvas = document.createElement('canvas')\n    this.ctx = this.canvas.getContext('2d')\n\n    container.appendChild(this.canvas)\n\n    this.things = new Things({\n      maxRockets: this.maxRockets,\n      numParticles,\n      cw: this.cw,\n      ch: this.ch,\n      rocketInitialPoint,\n      cannons,\n    })\n    this.updateDimensions()\n  }\n\n  destroy(): void {\n    this.canvas.parentElement.removeChild(this.canvas)\n    window.clearInterval(this.interval)\n    window.cancelAnimationFrame(this.rafInterval)\n  }\n\n  start(): () => void {\n    if (this.interval != null) return\n    this.interval = window.setInterval(\n      () => this.things.spawnRockets(),\n      this.rocketSpawnInterval\n    )\n    this.rafInterval = window.requestAnimationFrame(() => this.update())\n    return (): void => this.stop()\n  }\n\n  private updateDimensions(): void {\n    this.canvas.width = this.cw * this.pixelRatio\n    this.canvas.height = this.ch * this.pixelRatio\n    this.canvas.style.width = `${this.cw}px`\n    this.canvas.style.height = `${this.ch}px`\n    this.ctx.scale(this.pixelRatio, this.pixelRatio)\n    this.things.cw = this.cw\n    this.things.ch = this.ch\n  }\n\n  setSize(width: number, height: number): void {\n    this.cw = width\n    this.ch = height\n    this.updateDimensions()\n  }\n\n  resetSize(): void {\n    this.cw = this.container.clientWidth\n    this.ch = this.container.clientHeight\n    this.updateDimensions()\n  }\n\n  stop(): void {\n    window.clearInterval(this.interval)\n    this.interval = null\n  }\n\n  kill(): void {\n    this.things.clear()\n    this.stop()\n    window.cancelAnimationFrame(this.rafInterval)\n    this._finish()\n  }\n\n  fire(): void {\n    this.things.spawnRocket()\n    if (!this.rafInterval) {\n      this.rafInterval = window.requestAnimationFrame(() => this.update())\n    }\n  }\n\n  onFinish(cb: () => void): void {\n    this.finishCallbacks.push(cb)\n  }\n\n  private _clear(force = false): void {\n    this.ctx.globalCompositeOperation = 'destination-out'\n    this.ctx.fillStyle = `rgba(0, 0, 0 ${force ? '' : ', 0.5'})`\n    this.ctx.fillRect(0, 0, this.cw, this.ch)\n    this.ctx.globalCompositeOperation = 'lighter'\n  }\n\n  private _finish(): void {\n    this._clear(true)\n    this.rafInterval = null\n    this.finishCallbacks.forEach((cb) => cb())\n  }\n\n  update(): void {\n    this._clear()\n\n    for (const particle of this.things.entries()) {\n      particle.draw(this.ctx)\n      particle.update()\n\n      if (particle.shouldRemove(this.cw, this.ch)) {\n        this.things.delete(particle)\n      } else if (particle.shouldExplode(this.maxH, this.minH, this.chance)) {\n        this.things.explode(particle)\n      }\n    }\n\n    if (this.interval || this.things.size() > 0) {\n      this.rafInterval = window.requestAnimationFrame(() => this.update())\n    } else {\n      this._finish()\n    }\n  }\n}\n"],"names":[],"mappings":"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"}